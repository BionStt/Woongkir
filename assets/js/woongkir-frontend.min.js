!function(u){"use strict";var d={storeCountry:function(){this.getCountry().length||u.getJSON(woongkir_params.json.country_url,function(t){t.sort(function(t,i){return t.country_name>i.country_name?1:i.country_name>t.country_name?-1:0}),Lockr.set(woongkir_params.json.country_key,t)})},getCountry:function(t,i){var e=Lockr.get(woongkir_params.json.country_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},storeProvince:function(){this.getProvince().length||u.getJSON(woongkir_params.json.province_url,function(t){t.sort(function(t,i){return t.province_name>i.province_name?1:i.province_name>t.province_name?-1:0}),Lockr.set(woongkir_params.json.province_key,t)})},getProvince:function(t,i){var e=Lockr.get(woongkir_params.json.province_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},storeCity:function(){this.getCity().length||u.getJSON(woongkir_params.json.city_url,function(t){t.sort(function(t,i){return t.city_name>i.city_name?1:i.city_name>t.city_name?-1:0}),Lockr.set(woongkir_params.json.city_key,t)})},getCity:function(t,i){var e=Lockr.get(woongkir_params.json.city_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},storeSubdistrict:function(){this.getSubdistrict().length||u.getJSON(woongkir_params.json.subdistrict_url,function(t){t.sort(function(t,i){return t.subdistrict_name>i.subdistrict_name?1:i.subdistrict_name>t.subdistrict_name?-1:0}),Lockr.set(woongkir_params.json.subdistrict_key,t)})},getSubdistrict:function(t,i){var e=Lockr.get(woongkir_params.json.subdistrict_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},searchLocation:function(t,i,e){var n=this;switch(e=e||"find"){case"filter":var r=t.filter(function(t){return n.isLocationMatch(t,i)});break;default:r=t.find(function(t){return n.isLocationMatch(t,i)})}return r||!1},isLocationMatch:function(t,i){var e=!0;for(var n in i)t.hasOwnProperty(n)&&String(t[n]).toLowerCase()===String(i[n]).toLowerCase()||(e=!1);return e}};d.storeCountry(),d.storeProvince(),d.storeCity(),d.storeSubdistrict(),u(document).ready(function(){u(document.body).on("country_to_state_changed",function(t,i,e){var o,n,c,s;n=e,(o=i)&&void 0!==o&&n&&void 0!==n&&(u("#calc_shipping_address_2_field").remove(),u(n).find("#billing_city, #shipping_city, #calc_shipping_city, #billing_address_2, #shipping_address_2").each(function(){var t=this;if(u(t).show().closest(".form-row").find(".select2-container").remove(),"ID"===o){if(u(t).is("input")){var e=u("<select></select>");if(u.each(t.attributes,function(t,i){switch(i.name){case"type":break;case"value":e.attr("data-value",i.value);break;default:e.attr(i.name,i.value.replace("input-text","woongkir-input-text").replace("select2-hidden-accessible",""))}}),0<=u(t).attr("id").indexOf("calc_shipping_city")){var i=u("#calc_shipping_postcode_field").clone().attr({id:u(t).attr("id").replace("city","address_2")+"_field"}).empty().insertBefore("#calc_shipping_postcode_field"),n=e.clone().append('<option value="">'+woongkir_params.text.select_subdistrict+"</option>");n.attr({id:u(t).attr("id").replace("city","address_2"),name:u(t).attr("id").replace("city","address_2")}).appendTo(i),u().select2&&n.select2({placeholderOption:"first",width:"100%"})}var r=0<=u(t).attr("id").indexOf("city")?woongkir_params.text.select_city:woongkir_params.text.select_subdistrict;e.append('<option value="">'+r+"</option>"),u(t).replaceWith(e),u().select2&&e.select2({placeholderOption:"first",width:"100%"})}}else if(u(t).is("select")){var a=u('<input type="text" />');u.each(t.attributes,function(t,i){switch(i.name){case"data-value":a.val(i.value);break;default:a.attr(i.name,i.value.replace("woongkir-input-text","input-text").replace("select2-hidden-accessible",""))}}),u(t).replaceWith(a)}}),n.find("#billing_state, #shipping_state, #calc_shipping_state").on("change",function(t){if(c=!1,"ID"===o){var i=u(this),n=u("#"+i.attr("id").replace("state","city"));if(n.find("option").not(":first").remove(),i.val()&&i.val().length&&(c=d.getProvince({code:i.val()}))){var e=d.getCity({province_id:c.province_id},"filter");e&&(u.each(e,function(t,i){var e=n.data("value")==i.type+" "+i.city_name?" selected":"";n.append('<option value="'+i.type+" "+i.city_name+'"'+e+">"+i.type+" "+i.city_name+"</option>")}),n.trigger("change"))}}}),n.find("#billing_city, #shipping_city, #calc_shipping_city").on("change",function(t){if("ID"===o){var i=u(this);i.attr("data-value",i.val());var n=u("#"+i.attr("id").replace("city","address_2"));if(n.find("option").not(":first").remove(),n.trigger("change"),i.val()&&i.val().length&&c){var e=i.val().split(" ").slice(0,1).join(""),r=i.val().split(" ").slice(1).join(" ");if(s=d.getCity({province_id:c.province_id,type:e,city_name:r})){var a=d.getSubdistrict({province_id:c.province_id,city_id:s.city_id},"filter");a&&(u.each(a,function(t,i){var e=n.data("value")===i.subdistrict_name?" selected":"";n.append('<option value="'+i.subdistrict_name+'"'+e+">"+i.subdistrict_name+"</option>")}),n.trigger("change"))}}}}),n.find("#billing_address_2, #shipping_address_2").on("change",function(t){u(this).attr("data-value",u(this).val())}),u(function(){n.find("#billing_state, #shipping_state, #calc_shipping_state").trigger("change")}))}),u(document.body).on("updated_wc_div",function(t){u(":input.country_to_state").trigger("change")}),u(document.body).on("updated_shipping_method",function(t){u(":input.country_to_state").trigger("change")})})}(jQuery);